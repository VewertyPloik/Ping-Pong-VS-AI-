<!DOCTYPE html>
<html>
<head>
  <title>Ping Pong vs AI</title>
  <style>
    body {
      background: black;
      color: white;
      text-align: center;
      margin: 0;
      font-family: Arial, sans-serif;
    }
    #homeScreen, #winScreen, #shopScreen, #settingsScreen {
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .screen h1 {
      font-size: 48px;
      margin-bottom: 20px;
    }
    .btn {
      padding: 15px 30px;
      font-size: 24px;
      margin: 10px;
      cursor: pointer;
      border: none;
      border-radius: 10px;
      background: white;
      color: black;
      transition: background 0.2s;
    }
    .btn:hover { background: #ddd; }
    canvas {
      display: none;
      background: black;
      margin: auto;
    }
    #pauseBtn {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 2;
      display: none;
    }
  </style>
</head>
<body>

  <div id="homeScreen" class="screen" style="display: flex;">
    <h1>Ping Pong vs AI</h1>
    <button class="btn" onclick="showDifficultyMenu()">Play Game</button>
    <button class="btn" onclick="showShop()">Ball Shop</button>
    <button class="btn" onclick="showStats()">Win Stats</button>
    <button class="btn" onclick="showSettings()">Settings</button>
  </div>

  <div id="difficultyMenu" class="screen">
    <h1>Select Difficulty</h1>
    <button class="btn" onclick="startGame('beginner')">Beginner</button>
    <button class="btn" onclick="startGame('normal')">Normal</button>
    <button class="btn" onclick="startGame('hard')">Hard</button>
    <button class="btn" onclick="returnToHome()">Back</button>
  </div>

  <div id="shopScreen" class="screen">
    <h1>Ball Shop</h1>
    <div id="shopItems"></div>
    <p>Coins: <span id="coinCount">0</span></p>
    <button class="btn" onclick="returnToHome()">Back</button>
  </div>

  <div id="winScreen" class="screen">
    <h1>Game Over</h1>
    <p id="winnerText"></p>
    <button class="btn" onclick="returnToHome()">Back to Home</button>
  </div>

  <div id="settingsScreen" class="screen">
    <h1>Settings</h1>
    <button class="btn" onclick="resetGame()">Reset Progress</button>
    <button class="btn" onclick="toggleSound()">Sound: <span id="soundStatus">On</span></button>
    <button class="btn" onclick="returnToHome()">Back</button>
  </div>

  <button id="pauseBtn" class="btn" onclick="pauseGame()">Pause</button>
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <script>
    // Variables
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let player, ai, ball, animationId;
    let difficulty = "normal";
    let gamePaused = false;
    let gameState = null;
    let coins = parseInt(localStorage.getItem("coins")) || 0;
    let wins = JSON.parse(localStorage.getItem("wins")) || { beginner: 0, normal: 0, hard: 0 };
    let ownedBalls = JSON.parse(localStorage.getItem("ownedBalls")) || ["white"];
    let selectedBall = localStorage.getItem("selectedBall") || "white";
    let soundOn = localStorage.getItem("sound") !== "off";

    const ballColors = {
      white: "white",
      red: "red",
      gold: "gold",
      monster: "purple"
    };

    const ballPrices = {
      red: 10,
      gold: 25,
      monster: 50
    };

    const sounds = {
      hit: new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg")
    };

    function playSound(name) {
      if (soundOn && sounds[name]) {
        sounds[name].currentTime = 0;
        sounds[name].play();
      }
    }

    function saveProgress() {
      localStorage.setItem("coins", coins);
      localStorage.setItem("wins", JSON.stringify(wins));
      localStorage.setItem("ownedBalls", JSON.stringify(ownedBalls));
      localStorage.setItem("selectedBall", selectedBall);
      localStorage.setItem("sound", soundOn ? "on" : "off");
    }

    function resetGame() {
      localStorage.clear();
      coins = 0;
      wins = { beginner: 0, normal: 0, hard: 0 };
      ownedBalls = ["white"];
      selectedBall = "white";
      soundOn = true;
      document.getElementById("soundStatus").textContent = "On";
      alert("Game progress reset.");
      saveProgress();
    }

    function toggleSound() {
      soundOn = !soundOn;
      document.getElementById("soundStatus").textContent = soundOn ? "On" : "Off";
      saveProgress();
    }

    function showScreen(id) {
      ["homeScreen", "difficultyMenu", "shopScreen", "winScreen", "settingsScreen"].forEach(screen => {
        document.getElementById(screen).style.display = "none";
      });
      document.getElementById(id).style.display = "flex";
    }

    function returnToHome() {
      showScreen("homeScreen");
    }

    function showDifficultyMenu() {
      const saved = localStorage.getItem("savedGame");
      if (saved) {
        if (confirm("Resume previous game?")) {
          resumeGame(JSON.parse(saved));
          return;
        } else {
          localStorage.removeItem("savedGame");
        }
      }
      showScreen("difficultyMenu");
    }

    function showStats() {
      let msg = `Beginner Wins: ${wins.beginner}\nNormal Wins: ${wins.normal}\nHard Wins: ${wins.hard}`;
      alert(msg);
    }

    function showSettings() {
      showScreen("settingsScreen");
    }

    function showShop() {
      showScreen("shopScreen");
      document.getElementById("coinCount").textContent = coins;
      const shopItems = document.getElementById("shopItems");
      shopItems.innerHTML = "";
      for (let ball in ballPrices) {
        const owned = ownedBalls.includes(ball);
        const btn = document.createElement("button");
        btn.className = "btn";
        btn.textContent = owned ? `Use ${ball}` : `Buy ${ball} (${ballPrices[ball]} coins)`;
        btn.onclick = () => {
          if (owned) {
            selectedBall = ball;
          } else if (coins >= ballPrices[ball]) {
            coins -= ballPrices[ball];
            ownedBalls.push(ball);
            selectedBall = ball;
          } else {
            alert("Not enough coins!");
            return;
          }
          saveProgress();
          showShop();
        };
        shopItems.appendChild(btn);
      }
    }

    function pauseGame() {
      cancelAnimationFrame(animationId);
      localStorage.setItem("savedGame", JSON.stringify(gameState));
      alert("Game paused. You can resume it later.");
      returnToHome();
      document.getElementById("pauseBtn").style.display = "none";
      canvas.style.display = "none";
    }

    function resumeGame(state) {
      gameState = state;
      player = state.player;
      ai = state.ai;
      ball = state.ball;
      difficulty = state.difficulty;
      selectedBall = state.selectedBall;
      document.getElementById("pauseBtn").style.display = "inline-block";
      canvas.style.display = "block";
      showScreen("");
      gameLoop();
    }

    function startGame(diff) {
      difficulty = diff;
      const paddleHeight = 120;
      player = { x: 0, y: 250, score: 0, h: paddleHeight };
      ai = { x: canvas.width - 10, y: 250, score: 0, h: paddleHeight };
      ball = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        r: 10,
        speedX: diff === "beginner" ? 4 : diff === "hard" ? 6.25 : 5,
        speedY: 3
      };
      document.getElementById("pauseBtn").style.display = "inline-block";
      canvas.style.display = "block";
      showScreen("");
      gameLoop();
    }

    function drawPaddle(x, y, h) {
      ctx.fillStyle = "white";
      ctx.fillRect(x, y, 10, h);
    }

    function drawBall() {
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
      ctx.fillStyle = ballColors[selectedBall] || "white";
      ctx.fill();
      ctx.closePath();
    }

    function drawBoundaries() {
      ctx.fillStyle = "blue";
      ctx.fillRect(0, 0, canvas.width, 5);
      ctx.fillRect(0, canvas.height - 5, canvas.width, 5);
      ctx.fillRect(0, 0, 5, canvas.height);
      ctx.fillRect(canvas.width - 5, 0, 5, canvas.height);
    }

    function drawScore() {
      ctx.font = "30px Arial";
      ctx.fillStyle = "white";
      ctx.fillText(player.score, 100, 50);
      ctx.fillText(ai.score, canvas.width - 130, 50);
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBoundaries();

      // Move ball
      ball.x += ball.speedX;
      ball.y += ball.speedY;

      // Bounce off top and bottom
      if (ball.y - ball.r < 0 || ball.y + ball.r > canvas.height) {
        ball.speedY *= -1;
      }

      // Collision
      if (
        ball.x - ball.r < player.x + 10 &&
        ball.y > player.y &&
        ball.y < player.y + player.h
      ) {
        playSound("hit");
        ball.speedX *= -1.1; // faster on hit
        ball.x = player.x + 10 + ball.r;
      }

      if (
        ball.x + ball.r > ai.x &&
        ball.y > ai.y &&
        ball.y < ai.y + ai.h
      ) {
        playSound("hit");
        ball.speedX *= -1;
        ball.x = ai.x - ball.r;
      }

      // AI movement
      const aiCenter = ai.y + ai.h / 2;
      if (aiCenter < ball.y - 20) ai.y += difficulty === "hard" ? 6 : difficulty === "beginner" ? 2 : 4;
      else if (aiCenter > ball.y + 20) ai.y -= difficulty === "hard" ? 6 : difficulty === "beginner" ? 2 : 4;

      // Scoring
      if (ball.x < 0) {
        ai.score++;
        resetBall();
      }

      if (ball.x > canvas.width) {
        player.score++;
        resetBall();
      }

      // Win condition
      if (player.score >= 5 || ai.score >= 5) {
        if (player.score > ai.score) {
          coins += difficulty === "beginner" ? 1 : difficulty === "normal" ? 3 : 5;
          wins[difficulty]++;
          saveProgress();
        }
        localStorage.removeItem("savedGame");
        canvas.style.display = "none";
        document.getElementById("pauseBtn").style.display = "none";
        document.getElementById("winnerText").textContent =
          player.score > ai.score ? "You Win!" : "AI Wins!";
        showScreen("winScreen");
        return;
      }

      // Save current game state
      gameState = { player, ai, ball, difficulty, selectedBall };

      drawPaddle(player.x, player.y, player.h);
      drawPaddle(ai.x, ai.y, ai.h);
      drawBall();
      drawScore();

      animationId = requestAnimationFrame(gameLoop);
    }

    function resetBall() {
      ball.x = canvas.width / 2;
      ball.y = canvas.height / 2;
      ball.speedX = difficulty === "beginner" ? 4 : difficulty === "hard" ? 6.25 : 5;
      ball.speedY = 3;
    }

    document.addEventListener("mousemove", e => {
      const rect = canvas.getBoundingClientRect();
      player.y = e.clientY - rect.top - player.h / 2;
    });

    // Load coin count initially
    document.getElementById("coinCount").textContent = coins;
  </script>
</body>
</html>
